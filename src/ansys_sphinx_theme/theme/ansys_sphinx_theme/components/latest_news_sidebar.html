{#
  Latest News Sidebar
  Displays a box with latest news items in the sidebar if configured.
  Supports both internal links and external URLs.
#}
  {# Latest news sidebar CSS #}
  {% if theme_latest_news %}
    <link href="{{ pathto('_static/styles/latest_news_sidebar.css', 1) }}" rel="stylesheet" />
  {% endif %}
{% if theme_latest_news %}
  {% set theme_latest_news_title = theme_latest_news.get('title', 'Latest News') %}
  {% set theme_latest_news_items = theme_latest_news.get('items', []) %}
  {% set theme_latest_news_show_date = theme_latest_news.get('show_date', true) %}
  {% set theme_latest_news_max_items = theme_latest_news.get('max_items', 5) %}

  <div class="sidebar-latest-news" aria-label="Latest News">
    <div class="news-box">
      <h4 class="news-header">
        <i class="news-icon">ðŸ“°</i>
        {{ theme_latest_news_title }}
      </h4>

      <div class="news-content">
        {% if theme_latest_news_items %}
          <ul class="news-list">
            {% for item in theme_latest_news_items[:theme_latest_news_max_items] %}
              {% set item_title = item.get('title', 'News Item') %}
              {% set item_url = item.get('url') %}
              {% set item_date = item.get('date') %}
              {% set item_excerpt = item.get('excerpt') %}
              {% set is_external = item_url and (item_url.startswith('http://') or item_url.startswith('https://')) %}

              <li class="news-item">
                <div class="news-item-content">
                  {% if item_url %}
                    <a href="{{ item_url }}"
                       class="news-link"
                       {% if is_external %}target="_blank" rel="noopener noreferrer"{% endif %}>
                      <h5 class="news-title">{{ item_title }}</h5>
                    </a>
                  {% else %}
                    <h5 class="news-title">{{ item_title }}</h5>
                  {% endif %}

                  {% if item_date and theme_latest_news_show_date %}
                    <div class="news-date">
                      <i class="date-icon">ðŸ“…</i>
                      {{ item_date }}
                    </div>
                  {% endif %}

                  {% if item_excerpt %}
                    <p class="news-excerpt">{{ item_excerpt }}</p>
                  {% endif %}

                  {% if is_external %}
                    <span class="external-link-indicator" title="External Link">ðŸ”—</span>
                  {% endif %}
                </div>
              </li>
            {% endfor %}
          </ul>

          {% if theme_latest_news.get('more_url') %}
            {% set more_url = theme_latest_news.get('more_url') %}
            {% set more_text = theme_latest_news.get('more_text', 'View all news') %}
            {% set more_is_external = more_url.startswith('http://') or more_url.startswith('https://') %}

            <div class="news-more">
              <a href="{{ more_url }}"
                 class="news-more-link"
                 {% if more_is_external %}target="_blank" rel="noopener noreferrer"{% endif %}>
                {{ more_text }} â†’
              </a>
            </div>
          {% endif %}
        {% else %}
          <p class="news-empty">No news items available.</p>
        {% endif %}
      </div>
    </div>
  </div>
{% endif %}